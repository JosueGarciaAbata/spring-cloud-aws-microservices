version: "3.9"

services:
  eureka-server:
    image: spring-ms-eureka-serveri
    build:
      context: .
      dockerfile: Dockerfile-eureka-server
    container_name: spring-ms-eureka-server
    labels:
      project: spring-microservices-on-aws
    ports:
      - "8761:8761"
    depends_on:
      - config-server
    networks:
      - spring-ms-net
    healthcheck:
      test: [ "CMD", "wget", "-qO-", "http://localhost:8761/actuator/health" ]
      interval: 10s
      timeout: 5s
      retries: 5

  microservice-items:
    image: spring-ms-microservice-itemsi
    depends_on:
      eureka-server:
        condition: service_healthy
    build:
      context: .
      dockerfile: Dockerfile-microservice-items
    container_name: spring-ms-microservice-items
    env_file:
      - ./microservice-items/.env
    labels:
      project: spring-microservices-on-aws
    ports:
      - "8081:8081"
    networks:
      - spring-ms-net

  microservice-products:
    image: spring-ms-microservice-productsi
    depends_on:
      eureka-server:
        condition: service_healthy
    build:
      context: .
      dockerfile: Dockerfile-microservice-products
    container_name: spring-ms-microservice-products
    env_file:
      - ./microservice-products/.env
    labels:
      project: spring-microservices-on-aws
    ports:
      - "8082:8082"
    networks:
      - spring-ms-net
networks:
  spring-ms-net:
    driver: bridge
